<!-- app/views/lessons/show.html.erb -->

<%
  domain_colors = {
    'Design Resilient Architectures' => { bg: 'from-blue-500 to-cyan-400', icon: 'ðŸ—ï¸', accent: 'bg-blue-500', text: 'text-blue-500' },
    'Design High-Performing Architectures' => { bg: 'from-green-500 to-emerald-400', icon: 'âš¡', accent: 'bg-green-500', text: 'text-green-500' },
    'Design Secure Applications and Architectures' => { bg: 'from-purple-500 to-pink-400', icon: 'ðŸ”’', accent: 'bg-purple-500', text: 'text-purple-500' },
    'Design Cost-Optimized Architectures' => { bg: 'from-orange-500 to-red-400', icon: 'ðŸ’°', accent: 'bg-orange-500', text: 'text-orange-500' }
  }
  color = domain_colors[@domain.name] || { bg: 'from-gray-500 to-gray-400', icon: 'ðŸ“š', accent: 'bg-gray-500', text: 'text-gray-500' }
%>

<!-- XP Celebration Container -->
<div id="xp-celebration-container" class="fixed inset-0 pointer-events-none z-50"></div>

<!-- Top Navigation Bar -->
<nav class="bg-white/95 backdrop-blur-sm border-b border-white/20 sticky top-0 z-40 shadow-lg">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-20">
      <!-- Back to Domain & Lesson Title -->
      <div class="flex items-center space-x-4">
        <%= link_to domain_path(@domain), class: "flex items-center text-gray-600 hover:text-gray-900 transition" do %>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
          <span class="font-bold ml-2"><%= @domain.name %></span>
        <% end %>
      </div>

      <!-- Lesson Progress Bar -->
      <%= render "lessons/progress_bar", completion_percentage: @completion_percentage, correct_answers: @correct_answers, total_questions: @total_questions %>

      <!-- User Stats -->
      <%= render "layouts/user_stats" %>
    </div>
  </div>
</nav>

<!-- Main Content -->
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
  <!-- Lesson Header -->
  <div class="text-center mb-12">
    <h1 class="text-4xl font-black text-gray-800 mb-2"><%= @lesson.title %></h1>
    <p class="text-lg text-gray-600"><%= @lesson.summary %></p>
  </div>

  <!-- Lesson Content -->
  <div class="prose lg:prose-xl max-w-none bg-white rounded-2xl shadow-lg p-8 mb-12">
    <%= @lesson.content.html_safe %>
  </div>

  <!-- Interactive Questions -->
  <div>
    <h2 class="text-3xl font-black text-gray-800 mb-8 text-center">Check Your Knowledge</h2>
    <div class="space-y-8">
      <% @questions.each_with_index do |question, index| %>
        <%= render "lessons/question_card",
              question: question,
              index: index,
              user_answer: @user_answers[question.id],
              is_answered: @user_answers[question.id].present?,
              is_correct: @user_answers[question.id]&.correct?,
              domain: @domain,
              lesson: @lesson %>
      <% end %>
    </div>
  </div>

  <!-- Lesson Completion -->
  <div class="mt-16 text-center">
    <% if @completion_percentage == 100 %>
      <%= form_with url: complete_domain_lesson_path(@domain, @lesson), method: :post do |f| %>
        <%= f.submit "Complete Lesson & Claim XP", class: "bg-gradient-to-r from-green-500 to-emerald-500 text-white font-bold py-4 px-8 rounded-full text-xl hover:shadow-2xl transition-all duration-300 transform hover:scale-105" %>
      <% end %>
    <% else %>
      <p class="text-gray-600">Answer all questions correctly to complete the lesson.</p>
    <% end %>
  </div>
</div>