<!-- app/views/lessons/_question_card.html.erb -->
<%= turbo_frame_tag "question_#{question.id}" do %>
  <div class="question-card bg-white rounded-2xl shadow-lg p-8 border-l-4 <%= is_answered ? (is_correct ? 'border-green-500' : 'border-red-500') : 'border-gray-200' %>">
    <div class="flex justify-between items-start mb-4">
      <div>
        <h3 class="text-xl font-bold text-gray-800">Question <%= index + 1 %></h3>
        <p class="text-gray-600 mt-2"><%= question.text %></p>
      </div>
      <div class="bg-gray-100 text-gray-700 text-sm font-bold px-3 py-1 rounded-full">
        <%= question.experience_points %> XP
      </div>
    </div>

    <%= form_with url: answer_question_domain_lesson_path(domain, lesson, question_id: question.id), method: :post do |f| %>
      <div class="space-y-3">
        <% question.options.each do |option| %>
          <%
            selected_option = user_answer&.selected_answer == option
            is_correct_option = question.correct_answer == option
            
            option_class = "flex items-center p-4 rounded-lg border transition-all duration-200 cursor-pointer "
            if is_answered
              if is_correct_option
                option_class += "bg-green-100 border-green-300 text-green-800 font-bold"
              elsif selected_option
                option_class += "bg-red-100 border-red-300 text-red-800"
              else
                option_class += "bg-gray-50 border-gray-200 text-gray-600"
              end
            else
              option_class += "bg-gray-50 hover:bg-gray-100 border-gray-200"
            end
          %>
          <label class="<%= option_class %> w-full">
            <%= f.radio_button :selected_answer, option, class: "hidden", disabled: is_answered, onchange: "this.form.requestSubmit()" %>
            <span class="flex-grow"><%= option %></span>
            <% if is_answered %>
              <% if is_correct_option %>
                <span class="text-green-600">✔ Correct</span>
              <% elsif selected_option %>
                <span class="text-red-600">✖ Incorrect</span>
              <% end %>
            <% end %>
          </label>
        <% end %>
      </div>
    <% end %>

    <% if is_answered %>
      <div class="mt-6 p-4 rounded-lg <%= is_correct ? 'bg-green-50' : 'bg-red-50' %>">
        <h4 class="font-bold <%= is_correct ? 'text-green-800' : 'text-red-800' %>">Explanation</h4>
        <p class="text-sm <%= is_correct ? 'text-green-700' : 'text-red-700' %> mt-2">
          <%= question.explanation %>
        </p>
      </div>
    <% end %>
  </div>
<% end %>
